<!DOCTYPE >
<html>
	<title>竞赛申报系统</title>
	<head>
		<script src="./layui/layui.js"></script>
		<link href="./layui/css/layui.css"  rel="stylesheet"/>
		
		<script src="./host.js"></script>
		
		<script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
		
		<style>
			#buttonBox{
				float:left;
				width:15%;
				height:80%;
				margin:10px;
				border:solid 1px #ccc;
				background:#00a997;
				border-radius:5px;
				margin-right: 0;
			}
			.menu{
				height: 20%;
				color:#2c3e50;
				overflow: hidden;
				padding: 0 10px;
				z-index:1;
			}
			.menu:hover{
				background:#5fb878;
				cursor:pointer;
				color:#ffffff;
			}
      #mainContent{
        width: 81%;
				height:85%;
        margin: 10px 20px 20px 0;
        border:solid 1px #ccc;
        background:white;
        border-radius:5px;
        float: right;
				overflow: auto;
      }
			.icon{
				border-radius: 200px; 
				margin:auto;
			}
			.buttonIcon{
				height: 60%;
				margin-top:5px;
				text-align: center;
			}
			.buttonText{
				text-align: center;
			}
			.layui-form-label{
				width:110px;
			}
			.layui-input-block{
				margin-left: 140px;
			}
			#userName:hover{
				cursor:pointer
			}
		</style>
	</head>

	<body style="background-color: #eeeeee;">
		<ul class="layui-nav layui-bg-green">
			<li class="layui-nav-item layui-this"><a href="">主页</a></li>
      <li class="layui-nav-item layui-this layui-layout-right id=acc-info" style="margin-right:20px;">
        <a id="userName">解决方案</a>
        <dl class="layui-nav-child"> <!-- 二级菜单 -->
          <dd><a href="" >个人信息</a></dd>
          <dd><a href="index.html" >登出</a></dd>
        </dl>
      </li>
		</ul>

		<div id="buttonBox">
        <div id="headPhotoBox" class="icon" style="width: 70%; margin-top:10px;margin-bottom: 10px;border: 1px solid #eeeeee; ">
          <img  id="headPhoto" style="width: 100%;"/>
        </div>
        <div id="headName" style="font-size: 30px;width: 100%;text-align: center; margin: 10px 0;">
          name
        </div>
        <div style="height: 0.5px;width:80%;background: #eeeeee;text-align: center;margin:0 auto;"></div>

    		<div class="menu" id="userInfo">
					<div  class="icon buttonIcon">
		    	<i class="layui-icon layui-icon-username bigIcon"></i>
					</div>
					<div class="buttonText">个人信息</div>
		    </div>
				<div style="height: 2px;width:80%;background: #eeeeee;text-align: center;margin:0 auto;"></div>
		    <div class="menu" id="projectList">
		    	 <div  class="icon buttonIcon">
		    	 <i class="layui-icon layui-icon-read bigIcon"></i>
		    	 </div>
		    	 <div class="buttonText">作品列表</div>
		    </div>
				<div style="height: 2px;width:80%;background: #eeeeee;text-align: center;margin:0 auto;"></div>
        <div class="menu" id="projectInfo">
          <div  class="icon buttonIcon">
          <i class="layui-icon layui-icon-edit bigIcon"></i>
          </div>
          <div class="buttonText">新建作品</div>
       </div>
    </div>
    <div id="mainContent">
			<div id="backgroundBox"  style="width:100%;height: 100%;position: relative;">
				<img src="./img/background.png" style="width: 100%;height: 100%;"/>
				<div style="position: absolute;top: 150px;left: 100px;font-size: 40px;">欢迎使用XX竞赛申报系统</div>
			</div>
			<div id="studentProjectBox"  style="display: none; margin:20px;position: relative;top: 10%;">
				<h1 style="text-align: center;">参赛作品表</h1>
				<table id="studentProjectTable" lay-filter="test">
				</table>
			</div>
			<div class="layui-row" id="userInfoBox" style="position: relative;top: 20%; display: none;">	
				<div class="layui-col-md10 layui-col-md-offset1">
						<div class="layui-form-item">
							<label class="layui-form-label">学号</label>
							<div class="layui-input-inline" style="width: 80%;">
								<input type="text" name="account" id="account" disabled class="layui-input">
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">姓名</label>
							<div class="layui-input-inline" style="width: 80%;">
								<input type="text" name="name" id="name" disabled class="layui-input">
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">院系</label>
							<div class="layui-input-inline" style="width:80%">
								<input type="text" name="department" id="department" disabled class="layui-input">
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">专业</label>
							<div class="layui-input-inline" style="width:80%">
								<input type="text" name="major" id="major" disabled class="layui-input">
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">入学年份</label>
							<div class="layui-input-inline" style="width:80%">
								<input type="text" name="inYear" id="inYear" disabled class="layui-input">
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">联系电话</label>
							<div class="layui-input-inline" style="width:80%">
								<input type="text" name="phoneNumber" id="phoneNumber" disabled class="layui-input">
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">邮箱</label>
							<div class="layui-input-inline" style="width: 80%;">
								<input type="text" name="email" id="email" disabled class="layui-input">
							</div>
						</div>
				</div>
			</div>
			<div style="margin: 20px;display: none;" id="projectInfoBox">
				<div class="layui-form-item">
				  <label class="layui-form-label">作品代码</label>
				  <div class="layui-input-block" style="width: 200px; ">
				    <input type="text" name="projectID" disabled class="layui-input">
				  </div>
				</div>
			  <form class="layui-form" lay-filter="projectInfo">
			
			    <div class="layui-form-item" style="height: 20px;margin:15px 0px 10px 25px;">1.申报作品情况</div>
			
			    <div class="layui-form-item">
			      <label class="layui-form-label">作品名称</label>
			      <div class="layui-input-block" style="width: 200px; ">
			        <input type="text" name="nameOfWork" required  lay-verify="required" autocomplete="off" class="layui-input">
			      </div>
			    </div>
			
			    <div class="layui-form-item">
			      <label class="layui-form-label">作品类别</label>
			      <div class="layui-input-block">
			        <input type="radio" name="classificationOfWork" value="0" title="科技发明制作"checked>
			        <input type="radio" name="classificationOfWork" value="1" title="调查报告和学术论文" >
			      </div>
			    </div>
			
			
			    <div class="layui-form-item">
			      <label class="layui-form-label">作品分类</label>
			      <div class="layui-input-block">
			        <input type="radio" name="declarationOfWork" value="A" title="A.机械与控制（包括机械、仪器仪表、自动化控"checked>
			        <input type="radio" name="declarationOfWork" value="B" title="B.信息技术（包括计算机、电信、通讯、电子等）" >
			        <input type="radio" name="declarationOfWork" value="C" title="C.数理（包括数学、物理、地球与空间科学等）" >
			        <input type="radio" name="declarationOfWork" value="D" title="D.生命科学(包括生物､农学､药学､医学､健康､卫生､食品等)" >
			        <input type="radio" name="declarationOfWork" value="E" title="E.能源化工（包括能源、材料、石油、化学、化工、生态、环保等）">
			        <input type="radio" name="declarationOfWork" value="F" title="F.哲学社会科学（包括哲学、经济、社会、法律、教育、管理）" >
			      </div>
			    </div>
			
			    <div class="layui-form-item layui-form-text" style="width: 60%;">
			      <label class="layui-form-label">作品总体情况说明(不超过800字)</label>
			      <div class="layui-input-block">
			        <textarea name="overallDescriptionOfWork"  placeholder="请输入内容" class="layui-textarea"></textarea>
			      </div>
			    </div>
			
			    <div class="layui-form-item layui-form-text" style="width: 60%;">
			      <label class="layui-form-label">创新点</label>
			      <div class="layui-input-block">
			        <textarea name="innovationPoint"  placeholder="（1-5条作品创意的创新点）" class="layui-textarea"></textarea>
			      </div>
			    </div>
			
			    <div class="layui-form-item layui-form-text" style="width: 60%;">
			      <label class="layui-form-label">关键词</label>
			      <div class="layui-input-block">
			        <textarea name="keyWord" placeholder="（4-7个体现作品核心技术和问题的关键词）" class="layui-textarea"></textarea>
			      </div>
			    </div>
			
			    <div class="layui-form-item" style="height: 20px;margin:0px 0px 0px 25px;">2.申报者情况</div>
			    <div class="layui-form-item" style="height: 1px;background:dimgrey;width: 80%;margin: 30px 10% 30px 10%"></div>
			
			      <div class="layui-form-item" style="width: 40%;display: inline-block;" >
			        <label class="layui-form-label">姓名</label>
			        <div class="layui-input-block" style="width: 200px;">
			          <input type="text" name="name" disabled class="layui-input">
			        </div>
			      </div>
			
			    <div class="layui-form-item" style="width: 40%;display: inline-block;" >
			        <label class="layui-form-label">学号</label>
			        <div class="layui-input-block" style="width: 200px;">
			          <input type="text" name="account" disabled class="layui-input">
			        </div>
			      </div>
			
			    <div class="layui-form-item" style="width: 100%;display: inline-block;" >
			      <label class="layui-form-label">出生年月</label>
			      <div class="layui-input-block" style="width: 400px;">
			        <input type="text" name="dateOfBirth" id="date" lay-verify="date|required" autocomplete="off" class="layui-input">
			      </div>
			    </div>
			
			    <div class="layui-form-item" style="width: 40%;display: inline-block;" >
			      <label class="layui-form-label">专业</label>
			      <div class="layui-input-block" style="width: 200px;">
			        <input type="text" name="major" disabled class="layui-input">
			      </div>
			    </div>
			
			    <div class="layui-form-item" style="width: 40%;display: inline-block;" >
			      <label class="layui-form-label">入学年份</label>
			      <div class="layui-input-block" style="width: 200px;">
			        <input type="text" name="inYear" disabled class="layui-input">
			      </div>
			    </div>
			
			    <div class="layui-form-item" style="width: 40%;display: inline-block;" >
			      <label class="layui-form-label">作品全称</label>
			      <div class="layui-input-block" style="width: 200px;">
			        <input type="text" name="fullNameOfwork" required  lay-verify="required"  autocomplete="off" class="layui-input">
			      </div>
			    </div>
			
			    <div class="layui-form-item" style="width: 40%;display: inline-block;" >
			      <label class="layui-form-label">通讯地址</label>
			      <div class="layui-input-block" style="width: 200px;">
			        <input type="text" name="postalAddress" required  lay-verify="required"  autocomplete="off" class="layui-input">
			      </div>
			    </div>
			
			    <div class="layui-form-item" style="width: 40%;display: inline-block;" >
			      <label class="layui-form-label">联系电话</label>
			      <div class="layui-input-block" style="width: 200px;">
			        <input type="text" name="phoneNumber" disabled class="layui-input">
			      </div>
			    </div>
			
			    <div class="layui-form-item" style="width: 40%;display: inline-block;" >
			      <label class="layui-form-label">邮箱</label>
			      <div class="layui-input-block" style="width: 200px;">
			        <input type="text" name="email" disabled class="layui-input">
			      </div>
			    </div>
			
			    <div class="layui-form-item" style="width: 50%;">
			      <label class="layui-form-label">现学历</label>
			      <div class="layui-input-block">
			        <select name="currentEducation">
			          <option value=""></option>
			          <option value="0">大专</option>
			          <option value="1">大学本科</option>
			          <option value="2">硕士研究生</option>
			          <option value="3">博士研究生</option>
			        </select>
			      </div>
			    </div>
			
			    <div class="layui-form-item" style="height: 20px;margin:0px 0px 0px 25px;">3.合作者情况（最多填四个）</div>
			    <div class="layui-form-item" style="height: 1px;background:dimgrey;width: 80%;margin: 30px 10% 30px 10%"></div>
			
			    <div class="layui-form-item" style="width: 100%;">
			      <div class="layui-form-item" style="width: 17%;display: inline-block;" >
			        <label class="layui-form-label">姓名</label>
			        <div class="layui-input-block">
			          <input type="text" name="nameOfPartner1" autocomplete="off" class="layui-input">
			        </div>
			      </div>
			      <div class="layui-form-item" style="width: 17%;display: inline-block;" >
			        <label class="layui-form-label">学号</label>
			        <div class="layui-input-block">
			          <input type="text" name="studentIDOfPartner1"  autocomplete="off" class="layui-input">
			        </div>
			      </div>
			      <div class="layui-form-item" style="width: 17%;display: inline-block;" >
			        <label class="layui-form-label">联系电话</label>
			        <div class="layui-input-block">
			          <input type="text" name="phoneOfPartner1"  autocomplete="off" class="layui-input">
			        </div>
			      </div>
			      <div class="layui-form-item" style="width: 17%;display: inline-block;" >
			        <label class="layui-form-label">邮箱</label>
			        <div class="layui-input-block">
			          <input type="text" name="emailOfPartner1"  autocomplete="off" class="layui-input">
			        </div>
			      </div>
			      <div class="layui-form-item" style="width: 20%;display: inline-block;">
			        <label class="layui-form-label">现学历</label>
			        <div class="layui-input-block">
			          <select name="currenteducationOfPartner1">
			            <option value=""></option>
			            <option value="0">大专</option>
			            <option value="1">大学本科</option>
			            <option value="2">硕士研究生</option>
			            <option value="3">博士研究生</option>
			          </select>
			        </div>
			      </div>
			    </div>
			
			
			
			    <div class="layui-form-item" style="width: 100%;">
			      <div class="layui-form-item" style="width: 17%;display: inline-block;" >
			        <label class="layui-form-label">姓名</label>
			        <div class="layui-input-block">
			          <input type="text" name="nameOfPartner2" autocomplete="off" class="layui-input">
			        </div>
			      </div>
			      <div class="layui-form-item" style="width: 17%;display: inline-block;" >
			        <label class="layui-form-label">学号</label>
			        <div class="layui-input-block">
			          <input type="text" name="studentIDOfPartner2"  autocomplete="off" class="layui-input">
			        </div>
			      </div>
			      <div class="layui-form-item" style="width: 17%;display: inline-block;" >
			        <label class="layui-form-label">联系电话</label>
			        <div class="layui-input-block">
			          <input type="text" name="phoneOfPartner2"  autocomplete="off" class="layui-input">
			        </div>
			      </div>
			      <div class="layui-form-item" style="width: 17%;display: inline-block;" >
			        <label class="layui-form-label">邮箱</label>
			        <div class="layui-input-block">
			          <input type="text" name="emailOfPartner2"  autocomplete="off" class="layui-input">
			        </div>
			      </div>
			      <div class="layui-form-item" style="width: 20%;display: inline-block;">
			        <label class="layui-form-label">现学历</label>
			        <div class="layui-input-block">
			          <select name="currenteducationOfPartner2">
			            <option value=""></option>
			            <option value="0">大专</option>
			            <option value="1">大学本科</option>
			            <option value="2">硕士研究生</option>
			            <option value="3">博士研究生</option>
			          </select>
			        </div>
			      </div>
			    </div>
			
			
			    <div class="layui-form-item" style="width: 100%;">
			      <div class="layui-form-item" style="width: 17%;display: inline-block;" >
			        <label class="layui-form-label">姓名</label>
			        <div class="layui-input-block">
			          <input type="text" name="nameOfPartner3" autocomplete="off" class="layui-input">
			        </div>
			      </div>
			      <div class="layui-form-item" style="width: 17%;display: inline-block;" >
			        <label class="layui-form-label">学号</label>
			        <div class="layui-input-block">
			          <input type="text" name="studentIDOfPartner3"  autocomplete="off" class="layui-input">
			        </div>
			      </div>
			      <div class="layui-form-item" style="width: 17%;display: inline-block;" >
			        <label class="layui-form-label">联系电话</label>
			        <div class="layui-input-block">
			          <input type="text" name="phoneOfPartner3"  autocomplete="off" class="layui-input">
			        </div>
			      </div>
			      <div class="layui-form-item" style="width: 17%;display: inline-block;" >
			        <label class="layui-form-label">邮箱</label>
			        <div class="layui-input-block">
			          <input type="text" name="emailOfPartner3"  autocomplete="off" class="layui-input">
			        </div>
			      </div>
			      <div class="layui-form-item" style="width: 20%;display: inline-block;">
			        <label class="layui-form-label">现学历</label>
			        <div class="layui-input-block">
			          <select name="currenteducationOfPartner3">
			            <option value=""></option>
			            <option value="0">大专</option>
			            <option value="1">大学本科</option>
			            <option value="2">硕士研究生</option>
			            <option value="3">博士研究生</option>
			          </select>
			        </div>
			      </div>
			    </div>
			
			
			    <div class="layui-form-item" style="width: 100%;">
			      <div class="layui-form-item" style="width: 17%;display: inline-block;" >
			        <label class="layui-form-label">姓名</label>
			        <div class="layui-input-block">
			          <input type="text" name="nameOfPartner4" autocomplete="off" class="layui-input">
			        </div>
			      </div>
			      <div class="layui-form-item" style="width: 17%;display: inline-block;" >
			        <label class="layui-form-label">学号</label>
			        <div class="layui-input-block">
			          <input type="text" name="studentIDOfPartner4"  autocomplete="off" class="layui-input">
			        </div>
			      </div>
			      <div class="layui-form-item" style="width: 17%;display: inline-block;" >
			        <label class="layui-form-label">联系电话</label>
			        <div class="layui-input-block">
			          <input type="text" name="phoneOfPartner4"  autocomplete="off" class="layui-input">
			        </div>
			      </div>
			      <div class="layui-form-item" style="width: 17%;display: inline-block;" >
			        <label class="layui-form-label">邮箱</label>
			        <div class="layui-input-block">
			          <input type="text" name="emailOfPartner4"  autocomplete="off" class="layui-input">
			        </div>
			      </div>
			      <div class="layui-form-item" style="width: 20%;display: inline-block;">
			        <label class="layui-form-label">现学历</label>
			        <div class="layui-input-block" >
			          <select name="currenteducationOfPartner4">
			            <option value=""></option>
			            <option value="0">大专</option>
			            <option value="1">大学本科</option>
			            <option value="2">硕士研究生</option>
			            <option value="3">博士研究生</option>
			          </select>
			        </div>
			      </div>
			    </div>
			
			
			    <div class="layui-form-item" style="height: 1px;background:dimgrey;width: 80%;margin: 30px 10% 30px 10%"></div>
			    <div class="layui-row">
						<div class="layui-col-md2 layui-col-md-offset5">
			        <button class="layui-btn layui-btn-primary" lay-submit lay-filter="cache">下一页</button>
						</div>
			    </div>
					<button type="reset" id="reset" class="layui-btn layui-btn-primary" style="display: none;">重置</button>
			  </form>
			</div>
			<div style="margin: 20px;display: none;" id="uploadBox">
						<div class="layui-upload" style="margin: 10px;margin-bottom: 50px;">
					  <button type="button" class="layui-btn layui-btn-normal" id="imageList">选择图片（最多5张）</button> 
					  <div class="layui-upload-list">
					    <table class="layui-table">
					      <thead>
					        <tr><th>文件名</th>
					        <th>大小</th>
					        <th>状态</th>
					        <th>操作</th>
					      </tr></thead>
					      <tbody id="imagedemoList"></tbody>
					    </table>
					  </div>
					  <button type="button" class="layui-btn" id="imageListAction">开始上传</button>
						</div> 
						
						<div class="layui-upload" style="margin: 10px;margin-bottom: 50px;">
						<button type="button" class="layui-btn layui-btn-normal" id="fileList">选择文档（格式为PDF）</button> 
						<div class="layui-upload-list">
						  <table class="layui-table">
						    <thead>
						      <tr><th>文件名</th>
						      <th>大小</th>
						      <th>状态</th>
						      <th>操作</th>
						    </tr></thead>
						    <tbody id="filedemoList"></tbody>
						  </table>
						</div>
						<button type="button" class="layui-btn" id="fileListAction">开始上传</button>
						</div>
						
						<div class="layui-upload" style="margin: 10px;margin-bottom: 50px;">
						<button type="button" class="layui-btn layui-btn-normal" id="videoList">选择视频（大小不超过50M）</button> 
						<div class="layui-upload-list">
						  <table class="layui-table">
						    <thead>
						      <tr><th>文件名</th>
						      <th>大小</th>
						      <th>状态</th>
						      <th>操作</th>
						    </tr></thead>
						    <tbody id="videodemoList"></tbody>
						  </table>
						</div>
						<button type="button" class="layui-btn" id="videoListAction">开始上传</button>
						</div>
					<div class="layui-row">
						<div class="layui-col-md2 layui-col-md-offset3" style="text-align: center;">
							<button class="layui-btn layui-btn-primary" id="lastPage" style="width:60%;margin:auto;">上一页</button>
						</div>
						<div class="layui-col-md2" style="text-align: center;">
							<button class="layui-btn " id="submit" style="width:60%;margin:auto;">提交</button>
						</div>
						<div class="layui-col-md2" style="text-align: center;">
							<button class="layui-btn layui-btn-primary" id="save" style="width:60%;margin:auto;">保存</button>
						</div>
					</div>
			</div>
		</div>

	</body>
	<script>
		var projectID;
		var projectPeriod;
		
		var user=JSON.parse(sessionStorage.getItem("user"));
		$("#headName").html(user.account);
		$("#userName").html(user.account);
		$("#headPhotoBox").height($("#headPhotoBox").width());
		$('#headPhoto').attr("src", "./img/男.png");
		$(".buttonIcon").width($(".buttonIcon").height());
		$(".bigIcon").css("font-size",$(".buttonIcon").height()*0.7);
		$(".buttonText").css("font-size",$(".buttonIcon").height()*0.2);
    layui.use(['element','form','table','laydate'], function(){
      var element = layui.element;
			
			var index = layer.load(1, {
				shade: [0.1,'#fff'] //0.1透明度的白色背景
			});
			$.ajax({
					type:"GET",
					url: hostIP+"studentInfo?studentID="+user.account,
					dataType:"json",
					contentType:"application/json",
					success:function(data){
							layer.close(index);
							user=data;
							$("[name='account']").val(user.account);
							$("[name='name']").val(user.name);
							$("[name='department']").val(user.department);
							$("[name='major']").val(user.major);
							$("[name='inYear']").val(user.inYear);	
							$("[name='phoneNumber']").val(user.phoneNumber);
							$("[name='email']").val(user.email);
					}
			});
		 
			$("#projectList").click(function(){
					$("#userInfoBox").css("display","none");
					$("#projectInfoBox").css("display","none");
					$("#uploadBox").css("display","none");
					$("#backgroundBox").css("display","none");
					$("#studentProjectBox").css("display","block");
					$.ajax({
							type:"GET",
							url: hostIP+"studentProject?studentID="+user.account,
							dataType:"json",
							contentType:"application/json", 
							success:function(data){
											var table=layui.table;
											$("h1").html(data.competitionName+"参赛作品列表");
											table.render({
													elem: "#studentProjectTable",
													cols: [[ //标题栏
															{field: 'projectPeriod', width:150, title: '阶段',sort:true},
															{field: 'projectID', title: '作品代码',sort:true},
															{field: 'projectName', title: '作品名',sort:true},
															{field: 'id', title: '数据库编号',hide:true},
															{title:'操作', toolbar: '#TableBar', width:150 }
													]]
													,data:data.data
													//,size:'sm'
													// ,even: true
													,page: true
											});
											table.on('tool(test)', function(obj){
													var data = obj.data;
													if(obj.event==='del'){
															layer.confirm('确定删除 “'+data.projectName + '” ?',{icon: 3, title:'提示'},function (index) {
																	$.ajax({
																			type:"DELETE",
																			url: hostIP+"studentProject?id="+data.id,
																			dataType:"json",
																			contentType:"application/json", 
																			success:function(data){
																					if(data.status){
																							obj.del();
																							layer.close(index);
																					}
																			},
																	});
															});
													}
													if(obj.event==='export'){
															$.ajax({
																	type:"GET",
																	url: hostIP+"submitfile?projectID="+obj.data.id,
																	dataType:"json",
																	contentType:"application/json", 
																	success:function(data){
																			window.open(host+data.path);
																	},
															});
													}
													if(obj.event==='edit'){
															var data = obj.data;
															projectPeriod=data.projectPeriod;
															projectID=data.id;
															loadUpload();
															if(projectPeriod=="未提交"){
																$("#submit").css("display","block");
																$("#save").css("display","block");
															}
															else{
																$("#submit").css("display","none");
																$("#save").css("display","none");
															}
															$.ajax({
																	type:"GET",
																	url: hostIP+"studentProject?studentID="+user.account+"&id="+data.id,
																	dataType:"json",
																	contentType:"application/json", 
																	success:function(data){
																			$("#studentProjectBox").css("display","none");
																			$("#projectInfoBox").css("display","block");
																			$("[name='projectID']").val(data.data[0].projectID);
																			form.val('projectInfo', {
																				"nameOfWork":data.data[0].nameOfWork,
																				"classificationOfWork":data.data[0].classificationOfWork+"",
																				"declarationOfWork":data.data[0].declarationOfWork,
																				"overallDescriptionOfWork":data.data[0].overallDescriptionOfWork,
																				"innovationPoint":data.data[0].innovationPoint,
																				"keyWord":data.data[0].keyWord,
																				"dateOfBirth":data.data[0].dateOfBirth,
																				"fullNameOfwork":data.data[0].fullNameOfwork,
																				"postalAddress":data.data[0].postalAddress,
																				"currentEducation":data.data[0].currentEducation,
																				"account": user.account ,
																				"name": user.name,
																				"department": user.department,
																				"major": user.major ,
																				"inYear": user.inYear ,
																				"phoneNumber": user.phoneNumber,
																				"email": user.email
																			})
																			for(let i=1;i<=4;i++){
																				if(data.data[0].partner[i-1]){
																					$("[name='nameOfPartner"+i+"']").val(data.data[0].partner[i-1].nameOfPartner);
																					$("[name='studentIDOfPartner"+i+"']").val(data.data[0].partner[i-1].studentIDOfPartner);
																					$("[name='phoneOfPartner"+i+"']").val(data.data[0].partner[i-1].phoneOfPartner);
																					$("[name='emailOfPartner"+i+"']").val(data.data[0].partner[i-1].emailOfPartner);
																					$("[name='currenteducationOfPartner"+i+"']").val(data.data[0].partner[i-1].currenteducationOfPartner);
																				}
																				else{
																					$("[name='nameOfPartner"+i+"']").val("");
																					$("[name='studentIDOfPartner"+i+"']").val("");
																					$("[name='phoneOfPartner"+i+"']").val("");
																					$("[name='emailOfPartner"+i+"']").val("");
																					$("[name='currenteducationOfPartner"+i+"']").val("");
																				}
																			}
																			form.render();
																	},
															});	
													}
											});
							},
							error:function(){
									layer.msg("网络问题无法获得数据",{time:1000,icon:5});
							}
					});
			});
			
			$("#userInfo").click(function(){
					$("#studentProjectBox").css("display","none");
					$("#projectInfoBox").css("display","none");
					$("#uploadBox").css("display","none");
					$("#backgroundBox").css("display","none");
					$("#userInfoBox").css("display","block");
			});
			
			$("#projectInfo").click(function(){
					projectID=undefined;
					projectPeriod="未提交";
					$("#userInfoBox").css("display","none");
					$("#uploadBox").css("display","none");
					$("#studentProjectBox").css("display","none");
					$("#backgroundBox").css("display","none");
					$("#projectInfoBox").css("display","block");
					$("#submit").css("display","block");
					$("#save").css("display","block");
					
					$('#reset').trigger('click');
					$("[name='projectID']").val("");
					
					form.val('projectInfo', {
						"account": user.account 
						,"name": user.name
						,"department": user.department
						,"major": user.major //复选框选中状态
						,"inYear": user.inYear //开关状态
						,"phoneNumber": user.phoneNumber
						,"email": user.email
					})
					
					$("#mainContent").scrollTop(0);
					
			});
			
			var form = layui.form;
			var laydate = layui.laydate;
			
			laydate.render({
				elem: '#date'
			});
			
			$("#submit").click(function(){
				$.ajax({
						type:"PUT",
						url: hostIP+"studentProject?studentID="+user.account+"&id="+projectID,
						dataType:"json",
						contentType:"application/json", 
						data:JSON.stringify({status:"已提交"}),
						success:function(data){
							if(data.status){
								layer.msg("提交成功",{time:2000,icon:6});
								setTimeout("$('#projectList').trigger('click');",2000);
							}
							else{
								layer.msg("提交失败",{time:1000,icon:5});
							}
						},
				});
			});
			
			$("#save").click(function(){
				layer.msg("保存成功",{time:2000,icon:6});
				setTimeout("$('#projectList').trigger('click');",2000);
			});
			
			$("#lastPage").click(function(){
				$("#uploadBox").css("display","none");
				$("#projectInfoBox").css("display","block");
			});
			
			form.on('submit(cache)', function(data){
				if(projectPeriod=="未提交"){
					saveProject(data,"未提交");
				}
				else{
					$("#projectInfoBox").css("display","none");
					$("#uploadBox").css("display","block");
				}
			  return false;
			});
			
			function saveProject(data,status){
					data.field.partner=new Array();
					for(let i=1;i<=4;i++){
						data.field.partner.push({
								nameOfPartner:data.field["nameOfPartner"+i],
								studentIDOfPartner:data.field["studentIDOfPartner"+i],
								phoneOfPartner:data.field["phoneOfPartner"+i],
								emailOfPartner:data.field["emailOfPartner"+i],
								currenteducationOfPartner:data.field["currenteducationOfPartner"+i]
						});
					}
					data.field.status=status;
					if(projectID){
						$.ajax({
								type:"PUT",
								url: hostIP+"studentProject?studentID="+user.account+"&id="+projectID,
								dataType:"json",
								contentType:"application/json", 
								data:JSON.stringify(data.field),
								success:function(data){
									if(data.status){
										layer.msg("保存成功",{time:2000,icon:6});
										if(status=="已提交")
											setTimeout("$('#projectList').trigger('click');",2000);
										else{
											$("#projectInfoBox").css("display","none");
											$("#uploadBox").css("display","block");
										}
									}
									else{
										layer.msg("保存失败",{time:1000,icon:5});
									}
								},
						});
					}
					else{
						$.ajax({
								type:"POST",
								url: hostIP+"studentProject?studentID="+user.account,
								dataType:"json",
								contentType:"application/json", 
								data:JSON.stringify(data.field),
								success:function(data){
									if(data.status){
										layer.msg("保存成功",{time:2000,icon:6});
										$("#projectInfoBox").css("display","none");
										$("#uploadBox").css("display","block");
									}
									else{
										layer.msg("保存失败",{time:1000,icon:5});
									}
								}
						});
					}
			}
		});
		
		function loadUpload(){
			layui.use('upload', function(){
				var $ = layui.jquery;
			  var upload = layui.upload;
				
				var fileStatic=new Map(),imageNum=5,videoNum=1;
				
				$(".layui-upload-list tbody").empty();
				
				function deleteButtonBind(tr,ListView,ListIns,type,filename,index){
					tr.find('.demo-delete').on('click', function(){
					  var tr = ListView.find('tr#upload-'+ index)
					  ,tds = tr.children();
					  if(tds.eq(2).html()=='等待上传'){
							fileStatic[filename]=false;
					  	delete files[index]; //删除对应的文件
					  	tr.remove();
					  }
					  else{
					  	$.ajax({
					  		type:"DELETE",
					  		url: hostIP+"file?type="+type+"&projectID=26",
					  		//url: "http://localhost:3000/register",
					  		dataType:"json",
					  		contentType:"application/json", // 指定这个协议很重要
					  		data:JSON.stringify({filename:filename}), //只有这一个参数，json格式，后台解析为实体，后台可以直接用
					  		success:function(data){
					  			console.log(data);
					  			if(data.code){
										fileStatic[filename]=false;
					  				layer.msg("删除成功",{time:1000,icon:6});
										if(type==0)
											imageNum++;
										else
											videoNum++;
					  				tr.remove();
					  			}
					  			else{
					  					layer.msg("删除失败",{time:1000,icon:5});
					  					//layer.msg("其他错误",{time:1000,icon:5});
					  			}
					  		}
					  	});
					  }
					});
				}
				
				$.ajax({
						type:"GET",
						url: hostIP+"file?projectID="+projectID,
						dataType:"json",
						contentType:"application/json", 
						success:function(data){
							file=data.files;
							fileStatic=data.files;
								for(var i=0;i<file.length;i++){
									if(!file[i].path)
										continue;
										fileStatic[file[i].filename]=true;
									if(file[i].type==0){
											var tr = $(['<tr id="upload-'+ i +'">'
											  ,'<td><a target="view_window" href='+host+file[i].path+'>'+ file[i].filename +'</a></td>'
											  ,'<td>'+ file[i].datasize.toFixed(1) +'kb</td>'
											  ,'<td><span style="color: #5FB878;">上传成功</span></td>'
											  ,'<td>'
											    ,'<button class="layui-btn layui-btn-xs demo-reload layui-hide">重传</button>'
											    ,'<button class="layui-btn layui-btn-xs layui-btn-danger demo-delete">删除</button>'
											  ,'</td>'
											,'</tr>'].join(''));
											
											deleteButtonBind(tr,imagedemoListView,imageListIns,0,file[i].filename,i);
											
											imagedemoListView.append(tr);
											
											imageNum--;
									}
									if(file[i].type==1){
											var tr = $(['<tr id="upload-'+ i +'">'
											  ,'<td><a target="view_window" href='+host+file[i].path+'>'+ file[i].filename +'</a></td>'
											  ,'<td>'+ file[i].datasize.toFixed(1) +'kb</td>'
											  ,'<td><span style="color: #5FB878;">上传成功</span></td>'
											  ,'<td>'
											    ,'<button class="layui-btn layui-btn-xs demo-reload layui-hide">重传</button>'
											    ,'<button class="layui-btn layui-btn-xs layui-btn-danger demo-delete">删除</button>'
											  ,'</td>'
											,'</tr>'].join(''));
											
											deleteButtonBind(tr,filedemoListView,fileListIns,1,file[i].filename,i);
											
											filedemoListView.append(tr);
									}
									if(file[i].type==2){
											var tr = $(['<tr id="upload-'+ i +'">'
											  ,'<td><a target="view_window" href='+host+file[i].path+'>'+ file[i].filename +'</a></td>'
											  ,'<td>'+ file[i].datasize.toFixed(1) +'kb</td>'
											  ,'<td><span style="color: #5FB878;">上传成功</span></td>'
											  ,'<td>'
											    ,'<button class="layui-btn layui-btn-xs demo-reload layui-hide">重传</button>'
											    ,'<button class="layui-btn layui-btn-xs layui-btn-danger demo-delete">删除</button>'
											  ,'</td>'
											,'</tr>'].join(''));
											
											deleteButtonBind(tr,videodemoListView,videoListIns,2,file[i].filename,i);
											
											videodemoListView.append(tr);
											
											videoNum--;
									}
								}
						}
				});
			
				var imagedemoListView = $('#imagedemoList')
			  ,imageListIns = upload.render({
			    elem: '#imageList'
			    ,url: hostIP+'file?type=0&projectID='+projectID
			    ,accept: 'image'
			    ,multiple: true
			    ,auto: false
			    ,bindAction: '#imageListAction'
					,before: function(obj){ //obj参数包含的信息，跟 choose回调完全一致，可参见上文。
						layer.load(); //上传loading
					}
			    ,choose: function(obj){   
							if(imageNum<=0){
								layer.msg("选择文件数已达最大限度",{time:1000,icon:5});
								imageListIns.config.elem.next()[0].value = '';
								return;
							}
			      var files = this.files = obj.pushFile(); //将每次选择的文件追加到文件队列
			      //读取本地文件
			      obj.preview(function(index, file, result){
								if(fileStatic[file.name]){
									layer.msg("重复文件",{time:1000,icon:5});
									imageListIns.config.elem.next()[0].value = '';
									return;
								}
			        var tr = $(['<tr id="upload-'+ index +'">'
			          ,'<td>'+ file.name +'</td>'
			          ,'<td>'+ (file.size/1014).toFixed(1) +'kb</td>'
			          ,'<td>等待上传</td>'
			          ,'<td>'
			            ,'<button class="layui-btn layui-btn-xs demo-reload layui-hide">重传</button>'
			            ,'<button class="layui-btn layui-btn-xs layui-btn-danger demo-delete">删除</button>'
			          ,'</td>'
			        ,'</tr>'].join(''));
			        
			        //单个重传
			        tr.find('.demo-reload').on('click', function(){
			          obj.upload(index, file);
			        });
			        
			        //删除
			        tr.find('.demo-delete').on('click', function(){
								var tr = imagedemoListView.find('tr#upload-'+ index)
								,tds = tr.children();
								if(tds.eq(2).html()=='等待上传'){
									imageNum++;
									fileStatic[file.name]=false;
									delete files[index]; //删除对应的文件
									tr.remove();
									imageListIns.config.elem.next()[0].value = ''; //清空 input file 值，以免删除后出现同名文件不可选
								}
								else{
									$.ajax({
										type:"DELETE",
										url: hostIP+"file?type=0&projectID="+projectID,
										//url: "http://localhost:3000/register",
										dataType:"json",
										contentType:"application/json", // 指定这个协议很重要
										data:JSON.stringify({filename:file.name}), //只有这一个参数，json格式，后台解析为实体，后台可以直接用
										success:function(data){
											console.log(data);
											if(data.code){
												imageNum++;
												fileStatic[file.name]=false;
												layer.msg("删除成功",{time:1000,icon:6});
												delete files[index]; //删除对应的文件
												tr.remove();
												imageListIns.config.elem.next()[0].value = ''; //清空 input file 值，以免删除后出现同名文件不可选
											}
											else{
													layer.msg("删除失败",{time:1000,icon:5});
													//layer.msg("其他错误",{time:1000,icon:5});
											}
										}
									});
								}
			        });
			        imageNum--;
					    fileStatic[file.name]=true;
			        imagedemoListView.append(tr);
			      });
			    }
			    ,done: function(res, index, upload){
						layer.closeAll('loading');
			      if(res.code){ //上传成功
			        var tr = imagedemoListView.find('tr#upload-'+ index)
			        ,tds = tr.children();
			        tds.eq(2).html('<span style="color: #5FB878;">上传成功</span>');
							tds.eq(3).find('.demo-reload').addClass('layui-hide'); //隐藏重传
			        return delete this.files[index]; //删除文件队列已经上传成功的文件
			      }
			      this.error(index, upload);
			    }
			    ,error: function(index, upload){
						layer.closeAll('loading');
			      var tr = imagedemoListView.find('tr#upload-'+ index)
			      ,tds = tr.children();
			      tds.eq(2).html('<span style="color: #FF5722;">上传失败</span>');
			      tds.eq(3).find('.demo-reload').removeClass('layui-hide'); //显示重传
			    }
			  });
					
					var filedemoListView = $('#filedemoList')
					,fileListIns = upload.render({
					  elem: '#fileList'
					  ,url: hostIP+'file?type=1&projectID='+projectID
					  ,accept: 'file'
						,exts:'pdf'
					  ,multiple: true
					  ,auto: false
					  ,bindAction: '#fileListAction'
						,before: function(obj){ //obj参数包含的信息，跟 choose回调完全一致，可参见上文。
							layer.load(); //上传loading
						}
					  ,choose: function(obj){   
					    var files = this.files = obj.pushFile(); //将每次选择的文件追加到文件队列
					    //读取本地文件
					    obj.preview(function(index, file, result){
									if(fileStatic[file.name]){
										layer.msg("重复文件",{time:1000,icon:5});
										return;
									}
					      var tr = $(['<tr id="upload-'+ index +'">'
					        ,'<td>'+ file.name +'</td>'
					        ,'<td>'+ (file.size/1014).toFixed(1) +'kb</td>'
					        ,'<td>等待上传</td>'
					        ,'<td>'
					          ,'<button class="layui-btn layui-btn-xs demo-reload layui-hide">重传</button>'
					          ,'<button class="layui-btn layui-btn-xs layui-btn-danger demo-delete">删除</button>'
					        ,'</td>'
					      ,'</tr>'].join(''));
					      
					      //单个重传
					      tr.find('.demo-reload').on('click', function(){
					        obj.upload(index, file);
					      });
					      
					      //删除
					      tr.find('.demo-delete').on('click', function(){
					        var tr = filedemoListView.find('tr#upload-'+ index)
					        ,tds = tr.children();
					        if(tds.eq(2).html()=='等待上传'){
										fileStatic[file.name]=false;
					        	delete files[index]; //删除对应的文件
					        	tr.remove();
					        	fileListIns.config.elem.next()[0].value = ''; //清空 input file 值，以免删除后出现同名文件不可选
					        }
					        else{
					        	$.ajax({
					        		type:"DELETE",
					        		url: hostIP+"file?type=1&projectID="+projectID,
					        		//url: "http://localhost:3000/register",
					        		dataType:"json",
					        		contentType:"application/json", // 指定这个协议很重要
					        		data:JSON.stringify({filename:file.name}), //只有这一个参数，json格式，后台解析为实体，后台可以直接用
					        		success:function(data){
					        			console.log(data);
					        			if(data.code){
													fileStatic[file.name]=false;
					        				layer.msg("删除成功",{time:1000,icon:6});
					        				delete files[index]; //删除对应的文件
					        				tr.remove();
					        				fileListIns.config.elem.next()[0].value = ''; //清空 input file 值，以免删除后出现同名文件不可选
					        			}
					        			else{
					        					layer.msg("删除失败",{time:1000,icon:5});
					        					//layer.msg("其他错误",{time:1000,icon:5});
					        			}
					        		}
					        	});
					        }
					      });
					      
					      fileStatic[file.name]=true;
					      filedemoListView.append(tr);
					    });
					  }
					  ,done: function(res, index, upload){
							layer.closeAll('loading');
					    if(res.code){ //上传成功
					      var tr = filedemoListView.find('tr#upload-'+ index)
					      ,tds = tr.children();
					      tds.eq(2).html('<span style="color: #5FB878;">上传成功</span>');
								tds.eq(3).find('.demo-reload').addClass('layui-hide'); //隐藏重传
					      return delete this.files[index]; //删除文件队列已经上传成功的文件
					    }
					    this.error(index, upload);
					  }
					  ,error: function(index, upload){
							layer.closeAll('loading');
					    var tr = filedemoListView.find('tr#upload-'+ index)
					    ,tds = tr.children();
					    tds.eq(2).html('<span style="color: #FF5722;">上传失败</span>');
					    tds.eq(3).find('.demo-reload').removeClass('layui-hide'); //显示重传
					  }
					});
					
					var videodemoListView = $('#videodemoList')
					,videoListIns = upload.render({
					  elem: '#videoList'
					  ,url: hostIP+'file?type=2&projectID='+projectID
					  ,accept: 'video'
						,size:50*1024
					  ,multiple: true
					  ,auto: false
					  ,bindAction: '#videoListAction'
						,before: function(obj){ //obj参数包含的信息，跟 choose回调完全一致，可参见上文。
							layer.load(); //上传loading
						}
					  ,choose: function(obj){   
							if(videoNum<=0){
								layer.msg("选择文件数已达最大限度",{time:1000,icon:5});
					      videoListIns.config.elem.next()[0].value = ''; 
								return;
							}
					    var files = this.files = obj.pushFile(); //将每次选择的文件追加到文件队列
					    //读取本地文件
					    obj.preview(function(index, file, result){
									if(fileStatic[file.name]){
										layer.msg("重复文件",{time:1000,icon:5});
										videoListIns.config.elem.next()[0].value = ''; 
										return;
									}
					      var tr = $(['<tr id="upload-'+ index +'">'
					        ,'<td>'+ file.name +'</td>'
					        ,'<td>'+ (file.size/1014).toFixed(1) +'kb</td>'
					        ,'<td>等待上传</td>'
					        ,'<td>'
					          ,'<button class="layui-btn layui-btn-xs demo-reload layui-hide">重传</button>'
					          ,'<button class="layui-btn layui-btn-xs layui-btn-danger demo-delete">删除</button>'
					        ,'</td>'
					      ,'</tr>'].join(''));
					      
					      //单个重传
					      tr.find('.demo-reload').on('click', function(){
					        obj.upload(index, file);
					      });
					      
					      //删除
					      tr.find('.demo-delete').on('click', function(){
					        var tr = videodemoListView.find('tr#upload-'+ index)
					        ,tds = tr.children();
					        if(tds.eq(2).html()=='等待上传'){
										videoNum++;
										fileStatic[file.name]=false;
					        	delete files[index]; //删除对应的文件
					        	tr.remove();
					        	videoListIns.config.elem.next()[0].value = ''; //清空 input file 值，以免删除后出现同名文件不可选
					        }
					        else{
					        	$.ajax({
					        		type:"DELETE",
					        		url: hostIP+"file?type=2&projectID="+projectID,
					        		//url: "http://localhost:3000/register",
					        		dataType:"json",
					        		contentType:"application/json", // 指定这个协议很重要
					        		data:JSON.stringify({filename:file.name}), //只有这一个参数，json格式，后台解析为实体，后台可以直接用
					        		success:function(data){
					        			console.log(data);
					        			if(data.code){
													videoNum++;
													fileStatic[file.name]=false;
					        				layer.msg("删除成功",{time:1000,icon:6});
					        				delete files[index]; //删除对应的文件
					        				tr.remove();
					        				videoListIns.config.elem.next()[0].value = ''; //清空 input file 值，以免删除后出现同名文件不可选
					        			}
					        			else{
					        					layer.msg("删除失败",{time:1000,icon:5});
					        					//layer.msg("其他错误",{time:1000,icon:5});
					        			}
					        		}
					        	});
					        }
					      });
					      fileStatic[file.name]=true;
					      	videoNum--;
					      videodemoListView.append(tr);
					    });
					  }
					  ,done: function(res, index, upload){
							layer.closeAll('loading');
					    if(res.code){ //上传成功
					      var tr = videodemoListView.find('tr#upload-'+ index)
					      ,tds = tr.children();
					      tds.eq(2).html('<span style="color: #5FB878;">上传成功</span>');
								tds.eq(3).find('.demo-reload').addClass('layui-hide'); //隐藏重传
					      return delete this.files[index]; //删除文件队列已经上传成功的文件
					    }
					    this.error(index, upload);
					  }
					  ,error: function(index, upload){
							layer.closeAll('loading');
					    var tr = videodemoListView.find('tr#upload-'+ index)
					    ,tds = tr.children();
					    tds.eq(2).html('<span style="color: #FF5722;">上传失败</span>');
					    tds.eq(3).find('.demo-reload').removeClass('layui-hide'); //显示重传
					  }
					});
			});
		}
	</script>
	<script type="text/html" id="TableBar">
			<a class="layui-btn layui-btn-xs" lay-event="edit">查看</a>
			<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del" style="display: {{d.projectPeriod=='已提交'?'none':'inline-block'}};">删除</a>
			<a class="layui-btn layui-btn-xs" lay-event="export" style="display: {{d.projectPeriod=='已提交'?'inline-block':'none'}};">导出</a>
	</script>
</html>
